<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.40/Tone.js"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            transform: scale(1.25);
            margin-left: 20%;
            margin-top: 20%;
        }

        .power {
            width: 20px;
            height: 20px;

        }

        .key {
            width: 20px;
            height: 100px;
            font-size: 0.1rem;
            text-align: center;
            padding: 0;
            display: inline-block;
        }

        .black {
            background-color: black;
            color: white;
            line-height: 200px;
            position: absolute;
            margin-left: -10px;
        }

        .white {
            background-color: white;
            color: black;
            width: 30px;
            height: 200px;
        }

    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        var synth = null;
        var now = null;
        function getKeyList() {
            var list = [];
            var codeList = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
            for (var i = 2; i <= 7; i++) {
                for (var j = 0; j < codeList.length; j++) {
                    list.push(codeList[j] + i);
                }
            }
            list.push('C8');
            return list;

        }
        class Piano extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    power: false
                }
                this.toggle = this.toggle.bind(this);
                this.attack = this.attack.bind(this);
                this.release = this.release.bind(this);
            }
            attack(obj) {
                synth.triggerAttack(obj.target.id, now);
                console.log(obj.target.id);
            }
            release(obj) {
                synth.triggerRelease(obj.target.id, now);
                console.log(obj.target.id);
            }
            toggle() {
                if (synth == null) {
                    synth = new Tone.PolySynth().toDestination();
                    now = Tone.now();
                } else {
                    synth = null;
                }
                this.setState(prevState => ({
                    power: !prevState.power
                }));
            }
            render() {
                return (
                    <div className="piano">
                        <div>
                            <button onClick={this.toggle}>{this.state.power ? 'ON' : 'OFF'}</button>
                        </div>
                        {getKeyList().map((key) => <button className={'key ' + (key.length > 2 ? 'black' : 'white')} onContextMenu={(e) => e.preventDefault()} key={key} id={key}

                            onTouchStart={this.attack}
                            onTouchEnd={this.release}


                            on></button>)}
                    </div>
                )
            }
        };
        ReactDOM.render(
            <div>
                <Piano/>
            </div>,
            document.getElementById('root'))
    </script>
    <div id="root"></div>
    </script>

</body>

</html>